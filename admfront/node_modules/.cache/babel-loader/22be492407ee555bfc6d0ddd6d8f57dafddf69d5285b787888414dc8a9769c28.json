{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: \"HomeView.vue\",\n  data() {\n    const validatePass = (rule, value, callback) => {\n      if (value !== this.chpwdForm.password) {\n        callback(new Error('两次输入密码不一致!'));\n      } else {\n        callback();\n      }\n    };\n    return {\n      menulist: [],\n      user: {},\n      isCollapsed: false,\n      chpwdDialogVisible: false,\n      chpwdForm: {},\n      chpwdRules: {\n        oldPassword: [{\n          required: true,\n          message: '请输入旧密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 16,\n          message: '长度在 4 到 16 个字符',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 16,\n          message: '长度在 4 到 16 个字符',\n          trigger: 'blur'\n        }],\n        checkPass: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          validator: validatePass,\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.getMenuList();\n    this.getUserInfo();\n  },\n  methods: {\n    logout() {\n      window.localStorage.removeItem('token');\n      this.$router.push('/login');\n    },\n    async getMenuList() {\n      const {\n        data: response\n      } = await this.$http.get('users/meta/menulist/');\n      if (response.code) {\n        return this.$message.error(response.message);\n      }\n      this.menulist = response; // 菜单项数组\n    },\n\n    async getUserInfo() {\n      const {\n        data: response\n      } = await this.$http.get('users/meta/whoami/');\n      if (response.code) {\n        return this.$message.error(response.message);\n      }\n      this.user = response.user;\n    },\n    handleCommand(command) {\n      if (command === 'logout') {\n        this.logout();\n      } else if (command === 'chpwd') {\n        this.chpwdDialogVisible = true;\n      }\n    },\n    changePassword() {\n      this.$refs.chpwd.validate(async valid => {\n        if (valid) {\n          const {\n            data: response\n          } = await this.$http.post(`users/meta/chpwd/`, this.chpwdForm);\n          if (response.code) {\n            return this.$message.error(response.message);\n          }\n          this.chpwdDialogVisible = false;\n          this.$message('密码修改成功');\n        }\n      });\n    },\n    resetForm() {\n      this.$refs.chpwd.resetFields();\n    }\n  }\n};","map":{"version":3,"mappings":";AAwEA;EACAA;EACAC;IACA;MACA;QACAC;MACA;QACAA;MACA;IACA;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC,cACA;UAAAC;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,EACA;QACAG,WACA;UAAAL;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,EACA;QACAI,YACA;UAAAN;UAAAC;UAAAC;QAAA,GACA;UAAAK;UAAAL;QAAA;MAEA;IACA;EACA;EACAM;IACA;IACA;EACA;EACAC;IACAC;MACAC;MACA;IACA;IACA;MACA;QAAApB;MAAA;MACA;QACA;MACA;MACA;IACA;;IACA;MACA;QAAAA;MAAA;MACA;QACA;MACA;MACA;IACA;IACAqB;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;QACA;UACA;YAAAtB;UAAA,UACA;UACA;YACA;UACA;UACA;UACA;QACA;MACA;IACA;IACAuB;MACA;IACA;EACA;AACA","names":["name","data","callback","menulist","user","isCollapsed","chpwdDialogVisible","chpwdForm","chpwdRules","oldPassword","required","message","trigger","min","max","password","checkPass","validator","created","methods","logout","window","handleCommand","changePassword","resetForm"],"sourceRoot":"src/views","sources":["HomeView.vue"],"sourcesContent":["<template>\n  <el-container>\n      <!--menu 缩放，根据isCollapsed 的布尔  -->\n      <el-aside :width=\"isCollapsed ? '64px' : '200px'\">\n        <!--在el-menu中 :router=\"true\" ，开启路由 一旦开启路由后，点击el-menu-item菜单项就会按照index跳转 -->\n        <!--把 default-active 和 $route.path 关联 就会按照路径uri 菜单高亮 -->\n        <el-menu\n            router\n            background-color=\"#1F2D3D\"\n            text-color=\"#BFCBD9\"\n            active-text-color=\"#409EFF\"\n            :collapse=\"isCollapsed\"\n            :default-active=\"$route.path\"\n        >\n          <!-- v-for 生成menu -->\n          <el-submenu :index=\"item.id + ''\" v-for=\"item in menulist\" :key=\"item.id\">\n            <template slot=\"title\">\n              <i class=\"el-icon-menu\"></i>\n              <span>{{ item.name }}</span>\n            </template>\n            <el-menu-item :index=\"c.path\" v-for=\"c in item.children\" :key=\"c.id\">{{ c.name }}</el-menu-item>\n          </el-submenu>\n        </el-menu>\n      </el-aside>\n      <el-container>\n        <el-header>\n      <div class=\"logo\">\n<!--        <img src=\"../assets/img/head.jpeg\" alt=\"logo\"/>-->\n<!--        <div class=\"title\">Adm运维系统管理平台</div>-->\n        <div>\n          <i :class=\"isCollapsed ? 'el-icon-s-unfold' : 'el-icon-s-fold'\" @click=\"isCollapsed = !isCollapsed\"></i>\n        </div>\n      </div>\n      <div class=\"info\">\n        <!--        <el-button type=\"info\" @click=\"logout\">退出</el-button>-->\n        <el-dropdown @command=\"handleCommand\">\n          <span class=\"el-dropdown-link\">{{ user.username }}<i class=\"el-icon-arrow-down el-icon--right\"></i></span>\n          <el-dropdown-menu slot=\"dropdown\">\n            <el-dropdown-item command=\"chpwd\">修改密码</el-dropdown-item>\n            <el-dropdown-item command=\"logout\" divided>退出</el-dropdown-item>\n          </el-dropdown-menu>\n        </el-dropdown>\n      </div>\n      <!-- 修改密码对话框 -->\n      <el-dialog title=\"修改密码\" :visible.sync=\"chpwdDialogVisible\" @close=\"resetForm\">\n        <el-form :model=\"chpwdForm\" :rules=\"chpwdRules\" ref=\"chpwd\" label-width=\"100px\">\n          <el-form-item label=\"用户名\">{{ user.username }}</el-form-item>\n          <el-form-item label=\"旧密码\" prop=\"oldPassword\">\n            <el-input type=\"password\" v-model=\"chpwdForm.oldPassword\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"新密码\" prop=\"password\">\n            <el-input type=\"password\" v-model=\"chpwdForm.password\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"确认新密码\" prop=\"checkPass\">\n            <el-input type=\"password\" v-model=\"chpwdForm.checkPass\"></el-input>\n          </el-form-item>\n        </el-form>\n        <span slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"chpwdDialogVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"changePassword\">确 定</el-button>\n        </span>\n      </el-dialog>\n    </el-header>\n        <el-main>\n        <!-- 子路由嵌套 -->\n        <router-view></router-view>\n      </el-main>\n      </el-container>\n    </el-container>\n</template>\n\n<script>\nexport default {\n  name: \"HomeView.vue\",\n  data() {\n    const validatePass = (rule, value, callback) => {\n      if (value !== this.chpwdForm.password) {\n        callback(new Error('两次输入密码不一致!'))\n      } else {\n        callback()\n      }\n    };\n    return {\n      menulist: [],\n      user: {},\n      isCollapsed: false,\n      chpwdDialogVisible: false,\n      chpwdForm: {},\n      chpwdRules: {\n        oldPassword: [\n          {required: true, message: '请输入旧密码', trigger: 'blur'},\n          {min: 6, max: 16, message: '长度在 4 到 16 个字符', trigger: 'blur'}\n        ],\n        password: [\n          {required: true, message: '请输入新密码', trigger: 'blur'},\n          {min: 6, max: 16, message: '长度在 4 到 16 个字符', trigger: 'blur'}\n        ],\n        checkPass: [\n          {required: true, message: '请输入新密码', trigger: 'blur'},\n          {validator: validatePass, trigger: 'blur'}\n        ]\n      },\n    }\n  },\n  created() {\n    this.getMenuList()\n    this.getUserInfo()\n  },\n  methods: {\n    logout() {\n      window.localStorage.removeItem('token')\n      this.$router.push('/login')\n    },\n    async getMenuList() {\n      const {data: response} = await this.$http.get('users/meta/menulist/')\n      if (response.code) {\n        return this.$message.error(response.message)\n      }\n      this.menulist = response // 菜单项数组\n    },\n    async getUserInfo() {\n      const {data: response} = await this.$http.get('users/meta/whoami/')\n      if (response.code) {\n        return this.$message.error(response.message)\n      }\n      this.user = response.user\n    },\n    handleCommand(command) {\n      if (command === 'logout') {\n        this.logout()\n      } else if (command === 'chpwd') {\n        this.chpwdDialogVisible = true\n      }\n    },\n    changePassword() {\n      this.$refs.chpwd.validate(async (valid) => {\n        if (valid) {\n          const {data: response} = await\n              this.$http.post(`users/meta/chpwd/`, this.chpwdForm)\n          if (response.code) {\n            return this.$message.error(response.message)\n          }\n          this.chpwdDialogVisible = false\n          this.$message('密码修改成功')\n        }\n      })\n    },\n    resetForm() {\n      this.$refs.chpwd.resetFields()\n    },\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.el-container {\n  background-color: #fff;\n  height: 100%;\n}\n\n.el-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-left: 5px;\n\n  .logo {\n    display: flex;\n    align-items: center;\n\n    img {\n      width: 40px;\n    }\n\n    .title {\n      font-size: 20px;\n      margin-left: 5px;\n    }\n\n    i {\n      font-size: 25px;\n      margin-left: 5px;\n    }\n  }\n}\n\n.el-aside {\n  background-color: #304156;\n}\n\n.el-main {\n  background-color: #f0f2f4;\n}\n\n.el-menu {\n  border-right: none; // 消除菜单右侧白线\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}